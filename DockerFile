# Build stage: Use Maven + OpenJDK 17 to build the app
FROM maven:3.8.7-openjdk-17 AS build

WORKDIR /app

# Copy all project files (including pom.xml)
COPY . .

# Build the project and skip tests to speed up build
RUN mvn clean package -DskipTests

# Runtime stage: Use OpenJDK 17 to run the app
FROM openjdk:17-jdk

WORKDIR /app

# Copy the jar built from the previous stage
COPY --from=build /app/target/email_sender-0.0.1-SNAPSHOT.jar app.jar

# Expose port 8080
EXPOSE 8080

# Run the jar file
ENTRYPOINT ["java", "-jar", "app.jar"]
